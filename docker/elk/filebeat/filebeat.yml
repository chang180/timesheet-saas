filebeat.inputs:
  - type: filestream
    enabled: true
    id: laravel-logs
    paths:
      - /var/log/laravel/laravel.log
      - /var/log/laravel/laravel-*.log
    fields:
      application: laravel
      environment: ${ENVIRONMENT:-local}
    fields_under_root: false
    multiline.pattern: '^\['
    multiline.negate: true
    multiline.match: after
    multiline.max_lines: 500
    multiline.timeout: 5s
    exclude_lines: ['^#']
    include_lines: ['.*']
    exclude_files: ['.gz$']
    # filestream 會持續監控檔案，不需要 close_eof
    close_inactive: 1h
    close_renamed: true
    close_removed: true
    scan_frequency: 10s
    harvester_buffer_size: 16384
    max_bytes: 10485760
    harvester_buffer_size: 16384
    max_bytes: 10485760

filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: false

processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
  - add_docker_metadata: ~
  - add_fields:
      target: ''
      fields:
        log_type: laravel

output.logstash:
  hosts: ["logstash:5044"]
  worker: 1
  bulk_max_size: 2048
  timeout: 30s
  pipelining: 2

logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
